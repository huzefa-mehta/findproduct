<!DOCTYPE html>
<html>
<head>
<meta name="viewport"></meta>
<title>Milk.Findme - Google Fusion Tables</title>
<style type="text/css">
html, body, #googft-mapCanvas {
  height: 450px;
  margin: 15px;
  padding: 0px;
  width: 750px;
}
</style>

<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false&amp;v=3"></script>

<script type="text/javascript">
//google.load('visualization', '1');

  function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Error: The Geolocation service failed.';
  } else {
    var content = 'Error: Your browser doesn\'t support geolocation.';
  }

  var options = {
    map: map,
    position: new google.maps.LatLng(60, 105),
    content: content
  };

  var infowindow = new google.maps.InfoWindow(options);
  map.setCenter(options.position);
}

  function initialize() {
    google.maps.visualRefresh = true;
    var isMobile = (navigator.userAgent.toLowerCase().indexOf('android') > -1) ||
      (navigator.userAgent.match(/(iPod|iPhone|iPad|BlackBerry|Windows Phone|iemobile)/));
    if (isMobile) {
      var viewport = document.querySelector("meta[name=viewport]");
      viewport.setAttribute('content', 'initial-scale=1.0, user-scalable=no');
    }
    var mapDiv = document.getElementById('googft-mapCanvas');
    mapDiv.style.width = isMobile ? '100%' : '600px';
    mapDiv.style.height = isMobile ? '100%' : '360px';
    var map = new google.maps.Map(mapDiv, {
      center: new google.maps.LatLng(37.23571221595085, -122.02900131296383),
      zoom: 12,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById('googft-legend-open'));
    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById('googft-legend'));
	var curpos = new google.maps.LatLng(0,0)
	// Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
                                       position.coords.longitude);
	  curpos = pos;
	  var marker = new google.maps.Marker({
    // The below line is equivalent to writing:
    // position: new google.maps.LatLng(-34.397, 150.644)
    position: pos,
    map: map
      });

      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
        content: ''
      });

      map.setCenter(pos);
    }, function() {
      handleNoGeolocation(true);
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
var tableId = '1O6tQoCnle-2SrXQwRFUXoMQBmcRKroipZOCmDpjx';
var locationColumn = 'Location';
    layer = new google.maps.FusionTablesLayer({
      map: map,
      heatmap: { enabled: false },
      query: {
        select: locationColumn,
        from: tableId,
      },
      options: {
        styleId: 2,
        templateId: 2
      }
    });
	//initAutoComplete(tableId);
	 //google.maps.event.addDomListener(document.getElementById('go'), 'click',
            //function() {
	google.maps.event.addDomListener(document.getElementById('product'), 'keydown',
            function(e) {
              var product = document.getElementById('product').value;
			  if (e.keyCode != 13) {
				return
			  }

              if (product) {
                product = product.replace(/'/g, '\\\'');
                var where = "'Product' CONTAINS IGNORING CASE '" +
                    product + "'";

                layer.setOptions({
                  query: {
                    select: locationColumn,
                    from: tableId,
                    where: where,
					//orderBy: 'ST_DISTANCE(locationColumn, curpos)',
                    limit: 10
                  }
                });
              }
        });
	function initAutoComplete(tableId) {
        // Retrieve the unique product names using GROUP BY workaround.
        var queryText = encodeURIComponent(
            "SELECT 'Product', COUNT() " +
            'FROM ' + tableId + " GROUP BY 'Product'");
        var query = new google.visualization.Query(
            'http://www.google.com/fusiontables/gvizdata?tq='  + queryText);

        query.send(function(response) {
          var numRows = response.getDataTable().getNumberOfRows();

          // Create the list of results for display of autocomplete.
          var results = [];
          for (var i = 0; i < numRows; i++) {
            results.push(response.getDataTable().getValue(i, 0));
          }

          // Use the results to create the autocomplete options.
          $('#product').autocomplete({
            source: results,
            minLength: 2
          });
        });
      }
	 
	  

    if (isMobile) {
      var legend = document.getElementById('googft-legend');
      var legendOpenButton = document.getElementById('googft-legend-open');
      var legendCloseButton = document.getElementById('googft-legend-close');
      legend.style.display = 'none';
      legendOpenButton.style.display = 'block';
      legendCloseButton.style.display = 'block';
      legendOpenButton.onclick = function() {
        legend.style.display = 'block';
        legendOpenButton.style.display = 'none';
      }
      legendCloseButton.onclick = function() {
        legend.style.display = 'none';
        legendOpenButton.style.display = 'block';
      }
    }
  }

  google.maps.event.addDomListener(window, 'load', initialize);
  
  
</script>
</head>
<body>
<center>
<body style="background-color:gray">
<h1>Findme!</h1>
<h5><small>Search products in stores</small></h5>
 <div><input type="text" id="product"></div>
  <div id="googft-mapCanvas"></div>
 
	
	<footer>
<small> Contact: huzefa_mehta@yahoo.com reena_mehta@yahoo.com </small>
</footer>

	</center>
</body>
</html>